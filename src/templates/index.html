<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è AI Content Analysis</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Chart.js for statistics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        html {
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 50px;
            padding-top: 30px;
        }

        .logo {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 40px;
            backdrop-filter: blur(10px);
        }

        h1 {
            font-size: 36px;
            font-weight: 700;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .subtitle {
            font-size: 16px;
            opacity: 0.9;
            margin-bottom: 30px;
        }

        .analysis-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
            color: #333;
        }

        .analysis-section h3 {
            font-size: 24px;
            margin-bottom: 25px;
            color: #4f46e5;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analysis-tabs {
            display: flex;
            margin-bottom: 30px;
            background: rgba(79, 70, 229, 0.1);
            border-radius: 12px;
            padding: 5px;
            overflow-x: auto;
        }

        .analysis-tab {
            flex: 1;
            min-width: 120px;
            padding: 12px 20px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
            color: #6b7280;
            white-space: nowrap;
        }

        .analysis-tab.active {
            background: #4f46e5;
            color: white;
        }

        .analysis-content {
            display: none;
        }

        .analysis-content.active {
            display: block;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
        }

        .input-group textarea,
        .input-group input[type="text"],
        .input-group input[type="url"] {
            width: 100%;
            padding: 15px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 16px;
            transition: border-color 0.3s;
            font-family: inherit;
        }

        .input-group textarea:focus,
        .input-group input:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .input-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .file-input-container {
            position: relative;
            overflow: hidden;
            display: inline-block;
            width: 100%;
        }

        .file-input-container input[type=file] {
            position: absolute;
            left: -9999px;
        }

        .file-input-label {
            background: #f3f4f6;
            color: #374151;
            padding: 15px;
            border: 2px dashed #d1d5db;
            border-radius: 12px;
            text-align: center;
            cursor: pointer;
            transition: border-color 0.3s;
            width: 100%;
            display: block;
        }

        .file-input-label:hover {
            border-color: #4f46e5;
        }

        .file-name {
            margin-top: 10px;
            font-size: 14px;
            color: #6b7280;
        }

        .analyze-btn {
            background: linear-gradient(135deg, #4f46e5, #7c3aed);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
            width: 100%;
            margin-top: 10px;
        }

        .analyze-btn:hover {
            transform: translateY(-2px);
        }

        .analyze-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        .result {
            margin-top: 20px;
            padding: 20px;
            border-radius: 12px;
            display: none;
        }

        .result.success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .result.warning {
            background: #fef3c7;
            color: #92400e;
            border: 1px solid #fcd34d;
        }

        .result.error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fca5a5;
        }

        .result-info {
            margin-bottom: 10px;
            font-weight: 600;
        }

        .result-score {
            font-size: 24px;
            font-weight: 700;
            margin: 10px 0;
        }

        .result-details {
            margin-top: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 8px;
            font-size: 14px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            h1 {
                font-size: 28px;
            }

            .analysis-tabs {
                flex-wrap: wrap;
            }

            .analysis-tab {
                min-width: 100px;
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üõ°Ô∏è</div>
            <h1>AI Content Analysis</h1>
            <div class="subtitle">C√¥ng c·ª• ph√¢n t√≠ch n·ªôi dung th√¥ng minh</div>
        </div>

        <!-- Statistics Section -->
        <div class="row g-3 mb-5">
            <div class="col-12">
                <div class="card shadow-lg border-0" style="background: rgba(255, 255, 255, 0.95); border-radius: 20px;">
                    <div class="card-body p-4">
                        <h4 class="card-title text-primary mb-4 d-flex align-items-center gap-2">
                            üìä Th·ªëng k√™ t·ªïng quan
                        </h4>
                        <div class="row g-3">
                            <div class="col-md-3 col-sm-6">
                                <div class="text-center p-3 rounded-3" style="background: linear-gradient(135deg, #667eea, #764ba2); color: white;">
                                    <div class="h2 mb-2" id="total-alerts">0</div>
                                    <div class="h6 mb-1">T·ªïng c·∫£nh b√°o</div>
                                    <small class="opacity-75">T·ª´ khi b·∫Øt ƒë·∫ßu</small>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6">
                                <div class="text-center p-3 rounded-3" style="background: linear-gradient(135deg, #f093fb, #f5576c); color: white;">
                                    <div class="h2 mb-2" id="today-alerts">0</div>
                                    <div class="h6 mb-1">H√¥m nay</div>
                                    <small class="opacity-75">24 gi·ªù qua</small>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6">
                                <div class="text-center p-3 rounded-3" style="background: linear-gradient(135deg, #ffecd2, #fcb69f); color: #333;">
                                    <div class="h2 mb-2 text-danger" id="toxic-count">0</div>
                                    <div class="h6 mb-1">N·ªôi dung ƒë·ªôc h·∫°i</div>
                                    <small class="opacity-75">C·∫ßn ch√∫ √Ω</small>
                                </div>
                            </div>
                            <div class="col-md-3 col-sm-6">
                                <div class="text-center p-3 rounded-3" style="background: linear-gradient(135deg, #a8edea, #fed6e3); color: #333;">
                                    <div class="h2 mb-2 text-success" id="neutral-count">0</div>
                                    <div class="h6 mb-1">N·ªôi dung an to√†n</div>
                                    <small class="opacity-75">ƒê√£ x·ª≠ l√Ω</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Analysis Section -->
        <div class="analysis-section">
            <h3>üîç Ki·ªÉm tra n·ªôi dung</h3>

            <div class="analysis-tabs">
                <div class="analysis-tab active" onclick="switchTab('text')">üìù VƒÉn b·∫£n</div>
                <div class="analysis-tab" onclick="switchTab('image')">üñºÔ∏è H√¨nh ·∫£nh</div>
                <div class="analysis-tab" onclick="switchTab('video')">üé• Video</div>
                <div class="analysis-tab" onclick="switchTab('audio')">üé§ √Çm thanh</div>
                <div class="analysis-tab" onclick="switchTab('url')">üîó URL</div>
            </div>

            <!-- Text Analysis Tab -->
            <div id="text-analysis" class="analysis-content active">
                <div class="input-group">
                    <label for="text-input">Nh·∫≠p vƒÉn b·∫£n c·∫ßn ki·ªÉm tra:</label>
                    <textarea id="text-input" placeholder="Nh·∫≠p n·ªôi dung vƒÉn b·∫£n c·∫ßn ph√¢n t√≠ch..."></textarea>
                </div>
                <button class="analyze-btn" onclick="analyzeText()">
                    <span id="text-btn-text">üîç Ph√¢n t√≠ch vƒÉn b·∫£n</span>
                </button>
                <div id="text-result" class="result"></div>
            </div>

            <!-- Image Analysis Tab -->
            <div id="image-analysis" class="analysis-content">
                <div class="input-group">
                    <label>T·∫£i l√™n h√¨nh ·∫£nh c·∫ßn ki·ªÉm tra:</label>
                    <div class="file-input-container">
                        <input type="file" id="image-input" accept="image/*" onchange="handleImageSelect(event)">
                        <label for="image-input" class="file-input-label">
                            üìÅ Ch·ªçn h√¨nh ·∫£nh
                        </label>
                    </div>
                    <div id="image-file-name" class="file-name"></div>
                </div>
                <button class="analyze-btn" onclick="analyzeImage()" id="image-analyze-btn" style="display: none;">
                    <span id="image-btn-text">üîç Ph√¢n t√≠ch h√¨nh ·∫£nh</span>
                </button>
                <div id="image-result" class="result"></div>
            </div>

            <!-- Video Analysis Tab -->
            <div id="video-analysis" class="analysis-content">
                <div class="input-group">
                    <label>T·∫£i l√™n video c·∫ßn ki·ªÉm tra:</label>
                    <div class="file-input-container">
                        <input type="file" id="video-input" accept="video/*" onchange="handleVideoSelect(event)">
                        <label for="video-input" class="file-input-label">
                            üé• Ch·ªçn video
                        </label>
                    </div>
                    <div id="video-file-name" class="file-name"></div>
                </div>
                <button class="analyze-btn" onclick="analyzeVideo()" id="video-analyze-btn" style="display: none;">
                    <span id="video-btn-text">üîç Ph√¢n t√≠ch video</span>
                </button>
                <div id="video-result" class="result"></div>
            </div>

            <!-- Audio Analysis Tab -->
            <div id="audio-analysis" class="analysis-content">
                <div class="input-group">
                    <label>T·∫£i l√™n file √¢m thanh c·∫ßn ki·ªÉm tra:</label>
                    <div class="file-input-container">
                        <input type="file" id="audio-input" accept="audio/*" onchange="handleAudioSelect(event)">
                        <label for="audio-input" class="file-input-label">
                            üé§ Ch·ªçn file √¢m thanh
                        </label>
                    </div>
                    <div id="audio-file-name" class="file-name"></div>
                </div>
                <button class="analyze-btn" onclick="analyzeAudio()" id="audio-analyze-btn" style="display: none;">
                    <span id="audio-btn-text">üîç Ph√¢n t√≠ch √¢m thanh</span>
                </button>
                <div id="audio-result" class="result"></div>
            </div>

            <!-- URL Analysis Tab -->
            <div id="url-analysis" class="analysis-content">
                <div class="input-group">
                    <label for="url-input">Nh·∫≠p URL c·∫ßn ki·ªÉm tra:</label>
                    <input type="url" id="url-input" placeholder="https://example.com" />
                </div>
                <button class="analyze-btn" onclick="analyzeURL()">
                    <span id="url-btn-text">üîç Ki·ªÉm tra URL</span>
                </button>
                <div id="url-result" class="result"></div>
            </div>
        </div>
    </div>

    <script>
        // Tab switching functionality
        function switchTab(tabName) {
            // Hide all tabs
            document.querySelectorAll('.analysis-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.analysis-content').forEach(content => {
                content.classList.remove('active');
            });

            // Show selected tab
            event.target.classList.add('active');
            document.getElementById(tabName + '-analysis').classList.add('active');
        }

        // Text analysis
        async function analyzeText() {
            const text = document.getElementById('text-input').value.trim();
            const btn = document.querySelector('#text-analysis .analyze-btn');
            const btnText = document.getElementById('text-btn-text');
            const resultDiv = document.getElementById('text-result');

            if (!text) {
                showResult(resultDiv, 'Vui l√≤ng nh·∫≠p n·ªôi dung ƒë·ªÉ ki·ªÉm tra', 'error');
                return;
            }

            btn.disabled = true;
            btnText.innerHTML = '<span class="loading"></span> ƒêang ph√¢n t√≠ch...';

            try {
                const response = await fetch('/api/check_text', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ content: text })
                });

                const result = await response.json();
                const isToxic = result.result.label.toLowerCase() === 'toxic';

                showResult(resultDiv,
                    `K·∫øt qu·∫£: ${result.result.label.toUpperCase()} (${(result.result.score * 100).toFixed(1)}%)`,
                    isToxic ? 'warning' : 'success'
                );

            } catch (error) {
                showResult(resultDiv, 'L·ªói k·∫øt n·ªëi ƒë·∫øn server', 'error');
                console.error('Error:', error);
            } finally {
                btn.disabled = false;
                btnText.innerHTML = 'üîç Ph√¢n t√≠ch vƒÉn b·∫£n';
            }
        }

        // Image handling
        let selectedImageFile = null;

        function handleImageSelect(event) {
            selectedImageFile = event.target.files[0];
            const fileName = selectedImageFile ? selectedImageFile.name : '';
            document.getElementById('image-file-name').textContent = fileName;

            const analyzeBtn = document.getElementById('image-analyze-btn');
            analyzeBtn.style.display = fileName ? 'block' : 'none';
        }

        async function analyzeImage() {
            if (!selectedImageFile) return;

            const btn = document.getElementById('image-analyze-btn');
            const btnText = document.getElementById('image-btn-text');
            const resultDiv = document.getElementById('image-result');

            btn.disabled = true;
            btnText.innerHTML = '<span class="loading"></span> ƒêang ph√¢n t√≠ch...';

            try {
                const formData = new FormData();
                formData.append('file', selectedImageFile);

                const response = await fetch('/api/check_image', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (response.ok && result.result) {
                    const label = result.result.label || 'unknown';
                    const score = result.result.score || 0.0;
                    const isUnsafe = ['nsfw', 'porn', 'unsafe', 'suspicious'].includes(label.toLowerCase());

                    showResult(resultDiv,
                        `K·∫øt qu·∫£: ${label.toUpperCase()} (${(score * 100).toFixed(1)}%)`,
                        isUnsafe ? 'warning' : 'success'
                    );
                } else if (response.status === 400) {
                    showResult(resultDiv, `L·ªói: ${result.detail || 'File kh√¥ng h·ª£p l·ªá'}`, 'error');
                } else if (response.status === 500) {
                    showResult(resultDiv, `L·ªói server: ${result.detail || 'Kh√¥ng th·ªÉ x·ª≠ l√Ω h√¨nh ·∫£nh'}`, 'error');
                } else {
                    showResult(resultDiv, 'Kh√¥ng th·ªÉ ph√¢n t√≠ch h√¨nh ·∫£nh', 'error');
                }

            } catch (error) {
                showResult(resultDiv, 'L·ªói k·∫øt n·ªëi ƒë·∫øn server', 'error');
                console.error('Error:', error);
            } finally {
                btn.disabled = false;
                btnText.innerHTML = 'üîç Ph√¢n t√≠ch h√¨nh ·∫£nh';
            }
        }

        // Video handling
        let selectedVideoFile = null;

        function handleVideoSelect(event) {
            selectedVideoFile = event.target.files[0];
            const fileName = selectedVideoFile ? selectedVideoFile.name : '';
            document.getElementById('video-file-name').textContent = fileName;

            const analyzeBtn = document.getElementById('video-analyze-btn');
            analyzeBtn.style.display = fileName ? 'block' : 'none';
        }

        async function analyzeVideo() {
            if (!selectedVideoFile) return;

            const btn = document.getElementById('video-analyze-btn');
            const btnText = document.getElementById('video-btn-text');
            const resultDiv = document.getElementById('video-result');

            btn.disabled = true;
            btnText.innerHTML = '<span class="loading"></span> ƒêang ph√¢n t√≠ch...';

            try {
                const formData = new FormData();
                formData.append('file', selectedVideoFile);

                const response = await fetch('/api/check_video', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (response.ok && result) {
                    const label = result.label || 'unknown';
                    const score = result.score || 0.0;
                    const isSuspicious = label.toLowerCase() === 'suspicious';

                    let resultHTML = `
                        <div class="result-info">K·∫øt qu·∫£ ph√¢n t√≠ch video:</div>
                        <div class="result-score" style="color: ${isSuspicious ? '#dc2626' : '#065f46'}">
                            ${label.toUpperCase()} (${(score * 100).toFixed(1)}%)
                        </div>
                        <div class="result-details">
                            <strong>Th√¥ng tin video:</strong><br>
                            Th·ªùi l∆∞·ª£ng: ${result.duration ? Math.round(result.duration) + ' gi√¢y' : 'N/A'}<br>
                            T·ªïng khung h√¨nh: ${result.total_frames || 'N/A'}<br>
                            Khung h√¨nh ƒë√°ng ng·ªù: ${result.suspicious_frames || 0}
                        </div>
                    `;

                    if (result.details && result.details.length > 0) {
                        resultHTML += `<div class="result-details">
                            <strong>Chi ti·∫øt khung h√¨nh ƒë√°ng ng·ªù:</strong><br>
                            ${result.details.map(frame =>
                                `Khung ${frame.frame}: ${frame.result.label} (${(frame.result.score * 100).toFixed(1)}%)`
                            ).join('<br>')}
                        </div>`;
                    }

                    showResult(resultDiv, resultHTML, isSuspicious ? 'warning' : 'success');
                } else if (response.status === 400) {
                    showResult(resultDiv, `L·ªói: ${result.detail || 'File kh√¥ng h·ª£p l·ªá'}`, 'error');
                } else if (response.status === 500) {
                    showResult(resultDiv, `L·ªói server: ${result.detail || 'Kh√¥ng th·ªÉ x·ª≠ l√Ω video'}`, 'error');
                } else {
                    showResult(resultDiv, 'Kh√¥ng th·ªÉ ph√¢n t√≠ch video', 'error');
                }

            } catch (error) {
                showResult(resultDiv, 'L·ªói k·∫øt n·ªëi ƒë·∫øn server', 'error');
                console.error('Error:', error);
            } finally {
                btn.disabled = false;
                btnText.innerHTML = 'üîç Ph√¢n t√≠ch video';
            }
        }

        // Audio handling
        let selectedAudioFile = null;

        function handleAudioSelect(event) {
            selectedAudioFile = event.target.files[0];
            const fileName = selectedAudioFile ? selectedAudioFile.name : '';
            document.getElementById('audio-file-name').textContent = fileName;

            const analyzeBtn = document.getElementById('audio-analyze-btn');
            analyzeBtn.style.display = fileName ? 'block' : 'none';
        }

        async function analyzeAudio() {
            if (!selectedAudioFile) return;

            const btn = document.getElementById('audio-analyze-btn');
            const btnText = document.getElementById('audio-btn-text');
            const resultDiv = document.getElementById('audio-result');

            btn.disabled = true;
            btnText.innerHTML = '<span class="loading"></span> ƒêang ph√¢n t√≠ch...';

            try {
                const formData = new FormData();
                formData.append('file', selectedAudioFile);

                const response = await fetch('/api/check_audio', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.json();

                if (response.ok && result) {
                    const label = result.label || 'unknown';
                    const score = result.score || 0.0;
                    const isSuspicious = label.toLowerCase() === 'suspicious';

                    let resultHTML = `
                        <div class="result-info">K·∫øt qu·∫£ ph√¢n t√≠ch √¢m thanh:</div>
                        <div class="result-score" style="color: ${isSuspicious ? '#dc2626' : '#065f46'}">
                            ${label.toUpperCase()} (${(score * 100).toFixed(1)}%)
                        </div>
                    `;

                    if (result.transcription) {
                        resultHTML += `<div class="result-details">
                            <strong>N·ªôi dung nh·∫≠n di·ªán:</strong><br>
                            "${result.transcription}"
                        </div>`;
                    }

                    if (result.analysis) {
                        resultHTML += `<div class="result-details">
                            <strong>Ph√¢n t√≠ch vƒÉn b·∫£n:</strong><br>
                            ${result.analysis.label.toUpperCase()} (${(result.analysis.score * 100).toFixed(1)}%)
                        </div>`;
                    }

                    if (result.error) {
                        resultHTML += `<div class="result-details" style="color: #d97706;">
                            <strong>L∆∞u √Ω:</strong> ${result.error}
                        </div>`;
                    }

                    showResult(resultDiv, resultHTML, isSuspicious ? 'warning' : 'success');
                } else if (response.status === 400) {
                    showResult(resultDiv, `L·ªói: ${result.detail || 'File kh√¥ng h·ª£p l·ªá'}`, 'error');
                } else if (response.status === 500) {
                    showResult(resultDiv, `L·ªói server: ${result.detail || 'Kh√¥ng th·ªÉ x·ª≠ l√Ω √¢m thanh'}`, 'error');
                } else {
                    showResult(resultDiv, 'Kh√¥ng th·ªÉ ph√¢n t√≠ch √¢m thanh', 'error');
                }

            } catch (error) {
                showResult(resultDiv, 'L·ªói k·∫øt n·ªëi ƒë·∫øn server', 'error');
                console.error('Error:', error);
            } finally {
                btn.disabled = false;
                btnText.innerHTML = 'üîç Ph√¢n t√≠ch √¢m thanh';
            }
        }

        // URL analysis
        async function analyzeURL() {
            const url = document.getElementById('url-input').value.trim();
            const btn = document.querySelector('#url-analysis .analyze-btn');
            const btnText = document.getElementById('url-btn-text');
            const resultDiv = document.getElementById('url-result');

            if (!url) {
                showResult(resultDiv, 'Vui l√≤ng nh·∫≠p URL ƒë·ªÉ ki·ªÉm tra', 'error');
                return;
            }

            // Basic URL validation
            try {
                new URL(url);
            } catch {
                showResult(resultDiv, 'URL kh√¥ng h·ª£p l·ªá', 'error');
                return;
            }

            btn.disabled = true;
            btnText.innerHTML = '<span class="loading"></span> ƒêang ki·ªÉm tra...';

            try {
                const response = await fetch('/api/check_url', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ url: url })
                });

                const result = await response.json();
                const isDangerous = result.score > 0.4;

                let resultHTML = `
                    <div class="result-info">K·∫øt qu·∫£ ph√¢n t√≠ch URL:</div>
                    <div class="result-score" style="color: ${isDangerous ? '#dc2626' : '#065f46'}">
                        ${result.label.toUpperCase()} (${(result.score * 100).toFixed(1)}%)
                    </div>
                    <div class="result-details">
                        <strong>Khuy·∫øn ngh·ªã:</strong> ${result.recommendation}
                    </div>
                `;

                if (result.structure_analysis.reasons.length > 0) {
                    resultHTML += `<div class="result-details">
                        <strong>Nguy c∆° c·∫•u tr√∫c:</strong><br>
                        ${result.structure_analysis.reasons.join('<br>')}
                    </div>`;
                }

                if (result.content_analysis.reasons.length > 0) {
                    resultHTML += `<div class="result-details">
                        <strong>Nguy c∆° n·ªôi dung:</strong><br>
                        ${result.content_analysis.reasons.join('<br>')}
                    </div>`;
                }

                showResult(resultDiv, resultHTML, isDangerous ? 'warning' : 'success');

            } catch (error) {
                showResult(resultDiv, 'L·ªói k·∫øt n·ªëi ƒë·∫øn server', 'error');
                console.error('Error:', error);
            } finally {
                btn.disabled = false;
                btnText.innerHTML = 'üîç Ki·ªÉm tra URL';
            }
        }

        // Load statistics data
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();

                // Update statistics cards
                document.getElementById('total-alerts').textContent = stats.total_alerts || 0;
                document.getElementById('today-alerts').textContent = stats.total_alerts || 0; // Simplified for demo

                // Calculate toxic vs neutral
                const alertsByType = stats.alerts_by_type || {};
                const labelsByType = stats.labels_by_type || {};
                const toxicCount = (labelsByType.TEXT?.toxic || 0) + (labelsByType.IMAGE?.toxic || 0) +
                                 (labelsByType.TEXT?.suspicious || 0) + (labelsByType.IMAGE?.suspicious || 0);
                const neutralCount = (labelsByType.TEXT?.neutral || 0) + (labelsByType.IMAGE?.neutral || 0);

                document.getElementById('toxic-count').textContent = toxicCount;
                document.getElementById('neutral-count').textContent = neutralCount;

            } catch (error) {
                console.error('Error loading stats:', error);
                // Set default values on error
                document.getElementById('total-alerts').textContent = '0';
                document.getElementById('today-alerts').textContent = '0';
                document.getElementById('toxic-count').textContent = '0';
                document.getElementById('neutral-count').textContent = '0';
            }
        }

        // Helper function to show results
        function showResult(resultDiv, message, type) {
            resultDiv.innerHTML = message;
            resultDiv.className = `result ${type}`;
            resultDiv.style.display = 'block';

            // Auto hide after 10 seconds
            setTimeout(() => {
                resultDiv.style.display = 'none';
            }, 10000);
        }

        // WebSocket connection for real-time updates
        let ws = null;

        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/ws/alerts`;

            try {
                ws = new WebSocket(wsUrl);

                ws.onopen = function(event) {
                    console.log('[WS] Connected to WebSocket');
                };

                ws.onmessage = function(event) {
                    try {
                        const data = JSON.parse(event.data);
                        console.log('[WS] Received:', data);

                        if (data.type === 'new_alert' || data.type === 'stats_update') {
                            // Refresh statistics when new alert is detected
                            loadStats();
                        }
                    } catch (error) {
                        console.error('[WS] Error parsing message:', error);
                    }
                };

                ws.onclose = function(event) {
                    console.log('[WS] Disconnected from WebSocket');
                    // Reconnect after 5 seconds
                    setTimeout(connectWebSocket, 5000);
                };

                ws.onerror = function(error) {
                    console.error('[WS] WebSocket error:', error);
                };

            } catch (error) {
                console.error('[WS] Failed to create WebSocket connection:', error);
                // Retry connection after 5 seconds
                setTimeout(connectWebSocket, 5000);
            }
        }

        // Load statistics when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadStats();
            connectWebSocket(); // Connect to WebSocket for real-time updates
        });
    </script>
</body>
</html>
